# LOOM production example configuration.
# Do not commit real secrets. Load secrets from a secret manager/KMS.

# Public service mode
LOOM_PUBLIC_SERVICE=true
LOOM_REQUIRE_TLS_PROXY=true
LOOM_TLS_PROXY_CONFIRMED=true
LOOM_REQUIRE_HTTPS_FROM_PROXY=true

# Trust proxy headers only from known ingress ranges
LOOM_TRUST_PROXY=false
LOOM_TRUST_PROXY_ALLOWLIST=203.0.113.10/32,198.51.100.0/24

# Required admin secret
LOOM_ADMIN_TOKEN=replace-with-strong-random-token

# Node identity and signing (set via secret manager)
LOOM_NODE_ID=loom-node.example.com
LOOM_NODE_SIGNING_KEY_ID=k_node_sign_local_1
LOOM_NODE_SIGNING_PRIVATE_KEY_PEM=replace-via-secret-manager

# Persistence
LOOM_PG_URL=postgresql://loom:replace-password@db.example.com:5432/loom
LOOM_PG_SSL=true
LOOM_PG_SSL_REJECT_UNAUTHORIZED=true

# Federation and outbound host controls (required on public service)
LOOM_FEDERATION_HOST_ALLOWLIST=.partner.example.com
LOOM_FEDERATION_BOOTSTRAP_HOST_ALLOWLIST=.partner.example.com
LOOM_REMOTE_IDENTITY_HOST_ALLOWLIST=.partner.example.com
LOOM_WEBHOOK_HOST_ALLOWLIST=.internal.example.com

# Keep metrics authenticated by default
LOOM_METRICS_PUBLIC=false

# Keep demo/public-read modes disabled in production
LOOM_DEMO_PUBLIC_READS=false

# Inbound bridge hardening (public service)
LOOM_BRIDGE_EMAIL_INBOUND_ENABLED=true
LOOM_BRIDGE_EMAIL_INBOUND_PUBLIC_CONFIRMED=true
LOOM_BRIDGE_EMAIL_INBOUND_REQUIRE_ADMIN_TOKEN=true
LOOM_BRIDGE_EMAIL_INBOUND_REQUIRE_AUTH_RESULTS=true
LOOM_BRIDGE_EMAIL_INBOUND_REQUIRE_DMARC_PASS=true
LOOM_BRIDGE_EMAIL_INBOUND_REJECT_ON_AUTH_FAILURE=true
LOOM_BRIDGE_EMAIL_INBOUND_QUARANTINE_ON_AUTH_FAILURE=true

# Strongly recommended operational settings
LOOM_IDENTITY_REQUIRE_PROOF=true
LOOM_REQUIRE_PORTABLE_THREAD_OP_CAPABILITY=true
LOOM_FEDERATION_REQUIRE_SIGNED_RECEIPTS=true
LOOM_FEDERATION_CHALLENGE_ESCALATION_ENABLED=true

# Optional tuning examples (adjust from load tests)
LOOM_RATE_LIMIT_WINDOW_MS=60000
LOOM_RATE_LIMIT_DEFAULT_MAX=1000
LOOM_RATE_LIMIT_SENSITIVE_MAX=160
LOOM_IDENTITY_RATE_LIMIT_WINDOW_MS=60000
LOOM_IDENTITY_RATE_LIMIT_DEFAULT_MAX=1200
LOOM_IDENTITY_RATE_LIMIT_SENSITIVE_MAX=240
LOOM_FEDERATION_NODE_RATE_WINDOW_MS=60000
LOOM_FEDERATION_NODE_RATE_MAX=90
LOOM_FEDERATION_GLOBAL_RATE_WINDOW_MS=60000
LOOM_FEDERATION_GLOBAL_RATE_MAX=700
LOOM_OUTBOX_CLAIM_LEASE_MS=60000
LOOM_OUTBOX_WORKER_ID=loom-prod-node-1
LOOM_OUTBOX_AUTO_PROCESS_INTERVAL_MS=5000
LOOM_OUTBOX_AUTO_PROCESS_BATCH_SIZE=20
LOOM_EMAIL_OUTBOX_AUTO_PROCESS_INTERVAL_MS=5000
LOOM_EMAIL_OUTBOX_AUTO_PROCESS_BATCH_SIZE=20
LOOM_WEBHOOK_OUTBOX_AUTO_PROCESS_INTERVAL_MS=5000
LOOM_WEBHOOK_OUTBOX_AUTO_PROCESS_BATCH_SIZE=20
LOOM_REQUEST_LOG_ENABLED=true
LOOM_REQUEST_LOG_FORMAT=json

# Alternative native TLS mode (disable proxy mode when used)
# LOOM_NATIVE_TLS_ENABLED=true
# LOOM_NATIVE_TLS_CERT_FILE=/etc/loom/tls/fullchain.pem
# LOOM_NATIVE_TLS_KEY_FILE=/etc/loom/tls/privkey.pem
